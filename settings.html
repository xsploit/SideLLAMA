<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SideLlama Settings</title>
    <script src="tailwind.js"></script>
    <style>
        :root {
            --background: 0 0% 3.9%;
            --foreground: 0 0% 98%;
            --card: 0 0% 3.9%;
            --card-foreground: 0 0% 98%;
            --primary: 0 0% 98%;
            --primary-foreground: 0 0% 9%;
            --secondary: 0 0% 14.9%;
            --secondary-foreground: 0 0% 98%;
            --muted: 0 0% 14.9%;
            --muted-foreground: 0 0% 63.9%;
            --accent: 0 0% 14.9%;
            --accent-foreground: 0 0% 98%;
            --border: 0 0% 14.9%;
            --input: 0 0% 14.9%;
            --ring: 0 0% 63.9%;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
        }
        
        .scrollbar-none::-webkit-scrollbar {
            display: none;
        }
        
        .scrollbar-none {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .setting-card {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid hsl(var(--border));
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #374151; /* Dark gray for inactive */
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #4b5563;
        }

        .toggle-switch.active {
            background: #22c55e; /* Bright green for active */
            border-color: #16a34a;
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .toggle-switch.active::after {
            transform: translateX(18px);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch:hover {
            opacity: 0.9;
        }

        input, select, textarea {
            background-color: hsl(var(--input));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--border));
        }

        select option {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }

        textarea {
            font-family: inherit;
            resize: vertical;
        }

        .feature-badge {
            background: linear-gradient(45deg, #22c55e, #3b82f6);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .tool-badge {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="bg-background min-h-screen">
        <!-- Header -->
        <div class="border-b px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="relative flex shrink-0 overflow-hidden ring-border size-10 rounded-xl bg-white p-0.5 ring">
                        <div class="aspect-square size-full bg-blue-500 rounded-lg flex items-center justify-center text-white font-bold">
                            ü¶ô
                        </div>
                    </span>
                    <div>
                        <h1 class="text-xl font-semibold">SideLlama Settings</h1>
                        <p class="text-muted-foreground text-sm">Configure your AI assistant</p>
                    </div>
                </div>
                <button id="closeSettings" class="text-muted-foreground hover:text-foreground">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="p-6 max-w-4xl mx-auto">
            
            <!-- Ollama Configuration -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    üîß Ollama Configuration
                </h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Ollama Server URL</div>
                        <div class="text-sm text-muted-foreground">The URL where Ollama is running</div>
                    </div>
                    <input type="text" id="ollamaUrl" class="bg-input border border-border rounded-md px-3 py-2 text-sm w-48" value="http://localhost:11434">
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Connection Status</div>
                        <div class="text-sm text-muted-foreground">Current connection to Ollama</div>
                    </div>
                    <div id="connectionStatus" class="text-sm px-3 py-1 rounded-full bg-gray-500 text-white">
                        Checking...
                    </div>
                </div>
            </div>

            <!-- Tool Calling Features -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    üõ†Ô∏è Tool Calling Features
                    <span class="feature-badge">New in 2024</span>
                </h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Enable Tool Calls</div>
                        <div class="text-sm text-muted-foreground">Allow AI to use built-in tools for enhanced capabilities</div>
                    </div>
                    <div class="toggle-switch active" id="toolCallsToggle"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Auto-Manage Tool Calls</div>
                        <div class="text-sm text-muted-foreground">Automatically disable tool calls for vision models and enable for tool-capable models</div>
                    </div>
                    <div class="toggle-switch active" id="autoManageToolCallsToggle"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Enable Thinking Mode</div>
                        <div class="text-sm text-muted-foreground">Allow thinking models to show reasoning process for complex queries</div>
                    </div>
                    <div class="toggle-switch active" id="enableThinkingToggle"></div>
                </div>
                <div class="mt-4">
                    <div class="text-sm font-medium mb-2">Available Tools:</div>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="tool-badge">üîç Web Search</div>
                        <div class="tool-badge">üìÑ Webpage Scraping</div>
                        <div class="tool-badge">üì∏ Screenshot Capture</div>
                        <div class="tool-badge">üåê Page Context</div>
                    </div>
                </div>
            </div>

            <!-- Model Configuration -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4">ü§ñ Model Configuration</h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Default Model</div>
                        <div class="text-sm text-muted-foreground">The model to use by default</div>
                    </div>
                    <select id="defaultModel" class="bg-input border border-border rounded-md px-3 py-2 text-sm">
                        <option value="qwen2.5:7b">qwen2.5:7b</option>
                    </select>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Streaming Responses</div>
                        <div class="text-sm text-muted-foreground">Show responses as they're generated</div>
                    </div>
                    <div class="toggle-switch" id="streamingToggle"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Context Length</div>
                        <div class="text-sm text-muted-foreground">Maximum context window (32k+ recommended for tools)</div>
                    </div>
                    <select id="contextLength" class="bg-input border border-border rounded-md px-3 py-2 text-sm">
                        <option value="8192">8K</option>
                        <option value="16384">16K</option>
                        <option value="32768">32K</option>
                        <option value="65536">64K</option>
                        <option value="128000" selected>128K (Ollama Max)</option>
                    </select>
                </div>
                <div class="pt-4">
                    <div class="font-medium">System Prompt</div>
                    <div class="text-sm text-muted-foreground mb-2">The instructions given to the AI at the start of every conversation</div>
                    <textarea id="systemPrompt" class="bg-input border border-border rounded-md px-3 py-2 text-sm w-full h-32 resize-y" placeholder="You are SideLlama, a sophisticated and friendly AI assistant integrated into your browser. You are a knowledgeable and helpful companion for a wide range of tasks, from quick questions to in-depth research.

**Your Persona:**
- You are intelligent, kind, and proactive. You can lead the conversation and suggest new directions.
- You are a master of markdown and use it to create beautiful, easy-to-read responses.
- You enjoy thoughtful discussions about science, philosophy, and technology.

**Your Capabilities:**
- **Web Search:** You can search the web for up-to-date information.
- **Vision:** You can analyze images and screenshots.
- **Code Generation:** You can write and format code in various languages. You will always add comments to your code to explain what it does.
- **Markdown Formatting:** You can create beautiful and easy-to-read responses using markdown.

**Output Format:**
- Use markdown for all responses.
- Use headings, lists, and tables to organize information.
- Use code blocks for code snippets, and always add comments to your code.
- Use bold and italics to emphasize key points.
- Keep your responses concise and to the point."></textarea>
                </div>
            </div>

            <!-- Advanced Parameters -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    ‚öôÔ∏è Advanced Parameters
                    <span class="feature-badge">Ollama API</span>
                </h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Enable Advanced Parameters</div>
                        <div class="text-sm text-muted-foreground">Fine-tune model behavior with advanced options</div>
                    </div>
                    <div class="toggle-switch" id="advancedParamsToggle"></div>
                </div>
                
                <div id="advancedParamsSection" class="mt-4 space-y-4" style="display: none;">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm font-medium">Temperature</label>
                            <div class="text-xs text-muted-foreground mb-1">Creativity (0.0 = focused, 1.0 = creative)</div>
                            <input type="range" id="temperatureSlider" min="0" max="2" step="0.1" value="0.8" class="w-full">
                            <div class="text-xs text-center mt-1" id="temperatureValue">0.8</div>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Top P</label>
                            <div class="text-xs text-muted-foreground mb-1">Nucleus sampling (0.1 = focused, 1.0 = diverse)</div>
                            <input type="range" id="topPSlider" min="0.1" max="1" step="0.05" value="0.9" class="w-full">
                            <div class="text-xs text-center mt-1" id="topPValue">0.9</div>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Top K</label>
                            <div class="text-xs text-muted-foreground mb-1">Consider top K tokens</div>
                            <input type="range" id="topKSlider" min="1" max="100" step="1" value="20" class="w-full">
                            <div class="text-xs text-center mt-1" id="topKValue">20</div>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Repeat Penalty</label>
                            <div class="text-xs text-muted-foreground mb-1">Avoid repetition (1.0 = none, 1.2 = moderate)</div>
                            <input type="range" id="repeatPenaltySlider" min="1" max="2" step="0.05" value="1.1" class="w-full">
                            <div class="text-xs text-center mt-1" id="repeatPenaltyValue">1.1</div>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-medium">Seed (Optional)</label>
                        <div class="text-xs text-muted-foreground mb-1">Fixed seed for reproducible outputs</div>
                        <input type="number" id="seedInput" placeholder="Leave empty for random" class="bg-input border border-border rounded-md px-3 py-2 text-sm w-full">
                    </div>
                </div>
            </div>

            <!-- Structured Outputs -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    üìã Structured Outputs
                    <span class="feature-badge">JSON Mode</span>
                </h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Enable Structured Outputs</div>
                        <div class="text-sm text-muted-foreground">Force responses to follow JSON format or schema</div>
                    </div>
                    <div class="toggle-switch" id="structuredOutputToggle"></div>
                </div>
                
                <div id="structuredOutputSection" class="mt-4" style="display: none;">
                    <div class="setting-item">
                        <div>
                            <div class="font-medium">Output Format</div>
                            <div class="text-sm text-muted-foreground">Choose response format</div>
                        </div>
                        <select id="outputFormatSelect" class="bg-input border border-border rounded-md px-3 py-2 text-sm">
                            <option value="auto">Auto (Normal)</option>
                            <option value="json">JSON Mode</option>
                            <option value="schema">Custom Schema</option>
                        </select>
                    </div>
                    
                    <div id="jsonSchemaSection" class="pt-4" style="display: none;">
                        <label class="text-sm font-medium">JSON Schema</label>
                        <div class="text-xs text-muted-foreground mb-2">Define the structure for responses</div>
                        <textarea id="jsonSchemaInput" class="bg-input border border-border rounded-md px-3 py-2 text-sm w-full h-32 resize-y font-mono" placeholder='{"type": "object", "properties": {"name": {"type": "string"}}}'></textarea>
                    </div>
                </div>
            </div>

            <!-- Web Search Configuration -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4">üîç Web Search Configuration</h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Search Engine</div>
                        <div class="text-sm text-muted-foreground">Choose your preferred search provider</div>
                    </div>
                    <select id="searchEngine" class="bg-input border border-border rounded-md px-3 py-2 text-sm">
                        <option value="serper">Serper.dev (Google Results)</option>
                        <option value="duckduckgo">DuckDuckGo (Free)</option>
                    </select>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Serper API Key</div>
                        <div class="text-sm text-muted-foreground">Your Serper.dev API key for Google search results. <a href="https://serper.dev" target="_blank" class="text-blue-400 hover:underline">Get one free</a><br>
                        <span class="text-xs">Optional - Falls back to shared key if empty</span></div>
                    </div>
                    <input type="password" id="serperApiKey" class="bg-input border border-border rounded-md px-3 py-2 text-sm w-48" placeholder="Your API key (optional)" value="d03c7ebd4196bf9562d419973ae064">
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Max Search Results</div>
                        <div class="text-sm text-muted-foreground">Number of results to return</div>
                    </div>
                    <select id="maxResults" class="bg-input border border-border rounded-md px-3 py-2 text-sm">
                        <option value="3">3</option>
                        <option value="5" selected>5</option>
                        <option value="10">10</option>
                    </select>
                </div>
            </div>

            <!-- Privacy & Data -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4">üîí Privacy & Data</h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Auto Page Context</div>
                        <div class="text-sm text-muted-foreground">Automatically extract page context when opening</div>
                    </div>
                    <div class="toggle-switch" id="autoContextToggle"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Save Chat History</div>
                        <div class="text-sm text-muted-foreground">Store conversations locally</div>
                    </div>
                    <div class="toggle-switch active" id="saveHistoryToggle"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Screenshot Quality</div>
                        <div class="text-sm text-muted-foreground">Quality for image captures</div>
                    </div>
                    <select id="screenshotQuality" class="bg-input border border-border rounded-md px-3 py-2 text-sm">
                        <option value="60">Low (60%)</option>
                        <option value="80">Medium (80%)</option>
                        <option value="90" selected>High (90%)</option>
                        <option value="100">Maximum (100%)</option>
                    </select>
                </div>
            </div>

            <!-- Keyboard Shortcuts -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4">‚å®Ô∏è Keyboard Shortcuts</h2>
                <div class="space-y-3">
                    <div class="flex justify-between items-center text-sm">
                        <span>Open SideLlama</span>
                        <kbd class="px-2 py-1 bg-muted rounded text-xs">Ctrl+Shift+O</kbd>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span>Summarize Page</span>
                        <kbd class="px-2 py-1 bg-muted rounded text-xs">Ctrl+Shift+S</kbd>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span>Explain Selection</span>
                        <kbd class="px-2 py-1 bg-muted rounded text-xs">Ctrl+Shift+E</kbd>
                    </div>
                </div>
            </div>

            <!-- Model Management -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    üèÉ Running Models
                    <span class="feature-badge">Live Status</span>
                </h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Auto-refresh Running Models</div>
                        <div class="text-sm text-muted-foreground">Monitor active models in real-time</div>
                    </div>
                    <div class="toggle-switch" id="autoRefreshModelsToggle"></div>
                </div>
                
                <div class="mt-4">
                    <div class="flex justify-between items-center mb-3">
                        <div class="text-sm font-medium">Currently Running:</div>
                        <button id="refreshRunningModels" class="text-xs bg-secondary text-secondary-foreground px-2 py-1 rounded hover:opacity-80">
                            üîÑ Refresh
                        </button>
                    </div>
                    <div id="runningModelsList" class="space-y-2 min-h-[60px] max-h-40 overflow-y-auto">
                        <div class="text-sm text-muted-foreground text-center py-4">
                            Click refresh to check running models
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Monitoring -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    üìä Performance Monitoring
                    <span class="feature-badge">Analytics</span>
                </h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Show Performance Stats</div>
                        <div class="text-sm text-muted-foreground">Display tokens/sec, response time, and throughput</div>
                    </div>
                    <div class="toggle-switch" id="performanceStatsToggle"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Keep-Alive Duration</div>
                        <div class="text-sm text-muted-foreground">How long to keep models loaded in memory</div>
                    </div>
                    <select id="keepAliveSelect" class="bg-input border border-border rounded-md px-3 py-2 text-sm">
                        <option value="5m">5 minutes</option>
                        <option value="10m">10 minutes</option>
                        <option value="30m">30 minutes</option>
                        <option value="1h">1 hour</option>
                        <option value="-1">Keep indefinitely</option>
                    </select>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Show Thinking Process</div>
                        <div class="text-sm text-muted-foreground">Display AI reasoning in collapsible sections</div>
                    </div>
                    <div class="toggle-switch active" id="showThinkingToggle"></div>
                </div>
            </div>

            <!-- About -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4">‚ÑπÔ∏è About SideLlama</h2>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span>Version</span>
                        <span>2.0.0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Ollama Integration</span>
                        <span class="text-green-400">Latest 2024 Features</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Tool Calling Support</span>
                        <span class="text-green-400">Streaming & Function Calls</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Vision Capabilities</span>
                        <span class="text-green-400">Screenshot Analysis</span>
                    </div>
                </div>
            </div>

            <!-- Debug Section -->
            <div class="setting-card">
                <h2 class="text-lg font-semibold mb-4">üîß Debug Settings</h2>
                <div class="setting-item">
                    <div>
                        <div class="font-medium">Show Current Settings</div>
                        <div class="text-sm text-muted-foreground">Display all settings in console for debugging</div>
                    </div>
                    <button id="debugSettingsBtn" class="text-xs bg-secondary text-secondary-foreground px-3 py-1 rounded hover:opacity-80">
                        üêõ Debug
                    </button>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex justify-end mt-6">
                <button id="saveSettings" class="bg-primary text-primary-foreground px-6 py-2 rounded-md font-medium hover:opacity-90 transition-opacity">
                    Save Settings
                </button>
            </div>
        </div>
    </div>

    <script src="shared-utils.js"></script>
    <script type="module" src="settings.js"></script>
</body>
</html>